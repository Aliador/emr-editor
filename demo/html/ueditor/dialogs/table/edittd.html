<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link href="../../../dialog.css" type="text/css" rel="stylesheet" />
    <link href="../../pretty/bootstrap.min.css" rel="stylesheet">
    <link href="../../pretty/font-awesome.min.css" rel="stylesheet">
    <link async rel="stylesheet" href="../../pretty/materialdesignicons.min.css" />
    <link async rel="stylesheet" href="../../pretty/material-design-iconic-font.min.css" />
    <link async rel="stylesheet" href="../../pretty/ypicons.min.css" />
    <link async rel="stylesheet" href="../../pretty/ionicons.min.css" />
    <link href="../../pretty/icon?family=Material+Icons" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="../../pretty/pretty.min.css">
    <link rel="stylesheet" type="text/css" href="../../pretty/htmleaf-demo.css">
    <script type="text/javascript" src="../../third-party/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="../../third-party/md5.js"></script>
    <script type="text/javascript" src="../internal.js"></script>
    <style type="text/css">
       
    table td {
      padding: 8px 0px;
      overflow-y: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-size: 13px;
    }

    td input[type='text'] {
      width: 70%;
    }

    .title {
      width: 12%;
      text-align: right;
      padding-right: 10px;
    }

    .content {
      width: 70%;
      text-align: left;
      padding-left: 5px;
    }
    .form input[type='text'] {
      -webkit-border-radius: 0;
      -moz-border-radius: 0;
      border-radius: 0;
      background-color: transparent;
      border: none;
      box-shadow: none;
      outline: none;
      border-bottom: 1px solid #cccccc;
    }
    </style>
    <script type="text/javascript">
        format = function (date, fmt) { //author: meizz
            var o = {
                "M+": date.getMonth() + 1, //月份
                "d+": date.getDate(), //日
                "H+": date.getHours(), //小时
                "m+": date.getMinutes(), //分
                "s+": date.getSeconds(), //秒
                "q+": Math.floor((date.getMonth() + 3) / 3), //季度
                "S": date.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }

    </script>
</head>
<body>
<!-- <div class="section">
    <span><var id="lang_tdBkColor"></var></span>
    <input type="text" id="J_tone"/>
</div> -->
<div class="content">
    <table class="form" style="margin-top:20px;" id="myform">
        <tr>
            <td class="title"><span>填充颜色</span></td>
            <td class="content">
                <input type="hidden" id="nodeId" placeholder="控件ID" />
                <input type="color" id="bgColor" value="#FFFFFF" />
            </td>
        </tr>
        
        <tr>
            <td class="title"><span>数据格式</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="radio" name="textType" checked="checked" value="default">
                    <label><i class="mdi mdi-check"></i> 默认</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="textType" value="text">
                    <label><i class="mdi mdi-check"></i> 文本</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="textType" value="datetime">
                    <label><i class="mdi mdi-check"></i> 日期与时间</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="textType" value="score">
                    <label><i class="mdi mdi-check"></i> 得分</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="textType" value="check">
                    <label><i class="mdi mdi-check"></i> 勾选</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="textType" value="empty">
                    <label><i class="mdi mdi-check"></i> 空白</label>
                </div>
            </td>
        </tr>
        <tr type="datetime">
            <td class="title"><span> 日期格式</span></td>
            <td class="content">
                <input type="text" id="dateFmt" value="MM-dd hh:mm" />
            </td>
        </tr>

        <tr type="text|score|check|datetime">
            <td class="title"><span> 名称</span></td>
            <td class="content">
                <input type="text" id="nodeName" value="" />
            </td>
        </tr>
        <tr>
        <td class="title"><span>是否必填</span></td>
        <td class="content">
            <div class="pretty primary">
            <input id="required-yes" type="radio" name="required" checked="checked" value="1">
            <label><i class="mdi mdi-check"></i> 必填项</label>
            </div>
            <div class="pretty primary">
            <input id="required-no" type="radio" name="required" value="0">
            <label><i class="mdi mdi-check"></i> 非必填项</label>
            </div>
        </td>
        </tr>
        <tr type="text|score|check|datetime">
            <td class="title"><span> 名称(单元格方向)</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="radio" name="nodeNameSide" checked="checked" value="left">
                    <label><i class="mdi mdi-check"></i> 左</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="nodeNameSide" value="top">
                    <label><i class="mdi mdi-check"></i> 上</label>
                </div>
            </td>
        </tr>
        <tr type="text|score|check|datetime">
            <td class="title"><span> 名称(相对位置)</span></td>
            <td class="content">
                <input type="number" id="nodeNameOffset" value="1" />(格)
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span> 分组名称</span></td>
            <td class="content">
                <input type="text" id="groupName" value="" placeholder="" />
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span>总分名称</span></td>
            <td class="content">
                <input type="text" id="totalGroupName" value="" />
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span> 单元格方向</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="radio" name="scoreNameSide" checked="checked" value="left">
                    <label><i class="mdi mdi-check"></i> 左</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="scoreNameSide" value="top">
                    <label><i class="mdi mdi-check"></i> 上</label>
                </div>
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span> 名称(相对位置)</span></td>
            <td class="content">
                <input type="number" id="scoreNameOffset" value="2" />(格)
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span> 得分(相对位置)</span></td>
            <td class="content">
                <input type="number" id="scoreValueOffset" value="1" />(格)
            </td>
        </tr>
        <tr type="score">
            <td class="title"><span> 分组(相对位置)</span></td>
            <td class="content">
                <input type="number" id="scoreGroupOffset" value="3" />(格)
            </td>
        </tr>
        <tr>
            <td class="title"><span>边框</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="checkbox" name="border" value="left">
                    <label><i class="mdi mdi-check"></i> 左</label>
                </div>
                <div class="pretty primary">
                    <input type="checkbox" name="border" value="top">
                    <label><i class="mdi mdi-check"></i> 上</label>
                </div>
                <div class="pretty primary">
                    <input type="checkbox" name="border" value="right">
                    <label><i class="mdi mdi-check"></i> 右</label>
                </div>
                <div class="pretty primary">
                    <input type="checkbox" name="border" value="bottom">
                    <label><i class="mdi mdi-check"></i> 下</label>
                </div>
                <div class="pretty primary">
                    <input type="checkbox" name="border" value="default">
                    <label><i class="mdi mdi-check"></i> 默认</label>
                </div>
            </td>
        </tr>
        <tr>
            <td class="title"><span>边框颜色</span></td>
            <td class="content"><input type="color" id="borderColor" value="#3c3c3c" /></td>
        </tr>
        <tr>
            <td class="title"><span>边框厚度</span></td>
            <td class="content">
                <input type="number" id="borderWidth" value="1" />(px)
            </td>
        </tr>
        <tr>
            <td class="title"><span>对齐方式(水平)</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="radio" name="align" checked="checked" value="left">
                    <label><i class="mdi mdi-check"></i> 左对齐</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="align" value="center">
                    <label><i class="mdi mdi-check"></i> 居中</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="align" value="right">
                    <label><i class="mdi mdi-check"></i> 右对齐</label>
                </div>
            </td>
        </tr>
        <tr>
            <td class="title"><span>对齐方式(垂直)</span></td>
            <td class="content">
                <div class="pretty primary">
                    <input type="radio" name="valign" value="left">
                    <label><i class="mdi mdi-check"></i> 顶部</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="valign" checked="checked" value="center">
                    <label><i class="mdi mdi-check"></i> 居中</label>
                </div>
                <div class="pretty primary">
                    <input type="radio" name="valign" value="right">
                    <label><i class="mdi mdi-check"></i> 底部</label>
                </div>
            </td>
        </tr>
       
    </table>
</div>
<script src="../../../dialog.js"></script>
<script type="text/javascript">

    window.onload = function(){
        $("input[name='textType']").each(function () {
            $(this).click(function () {
                changedHtml(this.value);
            });
        })
    }
    function changedHtml(type) {
        var trs = document.getElementById("myform").getElementsByTagName("tr");
        for(var i=0, tr;tr=trs[i];i++) {
            var attr = "";
            if((attr = tr.getAttribute("type")) && attr.indexOf(type) == -1) {
                $(tr).hide();
            } else if((attr = tr.getAttribute("type")) && attr.indexOf(type) > -1) {
                $(tr).show();
            }
        }
    }

    var start = editor.selection.getStart(),
        $border = [],data, table,rowIndex,cellIndex,
        cells,cell = start && domUtils.findParentByTagName(start, ["td", "th"], true);

    var $style = {
        width: 0,
        height: 0,
        bgColor: "#ffffff",
        border: "none",
        borderColor: "#464646",
        borderWidth: "1px",
        align: "left",
        valign: "center",
        textType: "text",
        dateFmt: "MM-dd HH:mm",
        required: 0,

        nodeName: '',
        nodeNameOffset: 0,
        nodeNameSide: 'left',

        scoreNameSide: 'left',
        scoreNameOffset: 2,
        scoreValueOffset: 1,
        groupName: '',
        totalGroupName: '',

        // 表格边框
        borderBottomColor: "#464646",
        borderBottomWidth: 1,

        borderLeftColor: "#464646",
        borderLeftWidth: 1,

        borderRightColor: "#464646",
        borderRightWidth: 1,

        borderTopColor: "#464646",
        borderTopWidth: 1
    };

    if(cell){
        // getRowAndCol
        table = domUtils.findParentByTagName(cell,["table"], false);
        cells = editor.execCommand("rangecells");

        if(!cells) {
            cells = [cell];
        }

        var hata = cell.getAttribute("hata");

        if(hata && (data = eval("(" + hata + ")"))) {
          Object.assign($style, data);
        } else {
            data = {
                
            }
        }


        $style.align = cell.getAttribute("align") || 'left';
        $style.valign = cell.getAttribute("valign") || 'center';

        $style.borderColor = cell.style.borderColor;
        $style.borderWidth = cell.style.borderWidth;

        $style.bgColor = RGB2Hex(cell.style.backgroundColor || "rgb(255,255,255)");

        $style.borderBottomColor = cell.style.borderBottomColor;
        $style.borderBottomWidth = cell.style.borderBottomWidth;

        $style.borderLeftColor = cell.style.borderLeftColor;
        $style.borderLeftWidth = cell.style.borderLeftWidth;

        $style.borderRightColor = cell.style.borderRightColor;
        $style.borderRightWidth = cell.style.borderRightWidth;

        $style.borderTopColor = cell.style.borderTopColor;
        $style.borderTopWidth = cell.style.borderTopWidth;

        // var elements = domUtils.getElementsByTagName(cell,"p span");
        // // console.log(elements);
        // if(elements && elements.length > 0) {
        //     $style.color = elements[0].style.color || "#464646";
        //     $style.fontSize = elements[0].style.fontSize || 12;
        //     // $style.fontWeight = elements[0].style.fontWeight;
        //     $style.textAlign = elements[0].style.textAlign || "left";
        // }

        if($style.borderLeftColor) {
            $border.push('left');
        }
        if($style.borderTopColor) {
            $border.push('top');
        }
        if($style.borderRightColor) {
            $border.push('right');
        }
        if($style.borderBottomColor) {
            $border.push('bottom');
        }

        if($border.length == 4) {
            $style.border = "all";
        }

        if($style.borderColor) {
            $style.border = "all";
            $style.borderColor = cell.style.borderColor;
            $style.borderWidth = cell.style.borderWidth;

            if(cell.style.border) {
                var $cellBorder =  cell.style.border.replace(/, /g, ",").split(' ');
                $style.borderWidth = parseInt($cellBorder[0].replace("px",""));
                $style.borderColor = RGB2Hex($cellBorder[2]);
            }

            $border = ["left","top","right","bottom"];
        } else if($border.length > 0) {
            $style.borderColor = $style.borderLeftColor || $style.borderTopColor || $style.borderrightColor || $style.borderBottomColor;
            $style.borderWidth = ($style.borderLeftWidth || $style.borderTopWidth || $style.borderrightWidth || $style.borderBottomWidth) + "px";
        }

        if($border.length == 0) {
            // 没有边框
            $style.border = "none";
            $style.borderColor = "#464646";
            $style.borderWidth = 1;
        }

        $("input[name='border']").each(function(){
            if($border.indexOf(this.value)>-1) {
                this.setAttribute("checked", true);
            }
        });

        $("input[name='align']").each(function(){
            if($style.align == this.value) {
                this.setAttribute("checked", true);
            }
        });
        $("input[name='valign']").each(function(){
            if($style.valign == this.value) {
                this.setAttribute("checked", true);
            }
        });
        $("input[name='textType']").each(function(){
            if($style.textType == this.value) {
                this.setAttribute("checked", true);
            }
        });

        $("input[name='scoreNameSide']").each(function(){
            if($style.scoreNameSide == this.value) {
                this.setAttribute("checked", true);
            }
        });

        // console.log($style,data);

        for(var k in $style) {
            $id(k) && ($id(k).value = $style[k]);
        }

        // var color = domUtils.getComputedStyle(cell,'background-color');
        // if(/^#/.test(color)){
        //     tone.value = color
        // }
        changedHtml($style.textType);
    }


    dialog.onok = function() {
        if(cells) {

            var UT = UE.UETable, ut = UT.getUETable(table);
            const groupId = uuid();
            $border = [];

            $style.textType = $("input[name='textType']:checked").val() || 'text';
 
            $("input[name='border']:checked").each(function(){
                $border.push(this.value);
            });
            if($border.length == 1 && $border[0] == "default") {
                $style.border = "default";
            } else if($border.length == 4) {
                $style.border = "all";
            }else if($border.length == 0) {
                $style.border = "none";
            } else {
                $style.border = $border.join(",");
            }
            $style.borderColor = $id("borderColor").value || "#464646";
            $style.bgColor = $id("bgColor").value || "#ffffff";
            $style.borderWidth = ($id("borderWidth").value || "1");


            $style.align = ($("input[name='align']:checked").val() || 'left')
            $style.valign = ($("input[name='valign']:checked").val() || 'center')

            $style.nodeNameSide = ($("input[name='nodeNameSide']:checked").val() || 'left');

            $style.scoreNameSide = ($("input[name='scoreNameSide']:checked").val() || 'left');

            $style.nodeNameOffset = $id("nodeNameOffset").value || 0;

            $style.scoreNameOffset = $id("scoreNameOffset").value || 0;
            $style.scoreNameOffset = $id("scoreNameOffset").value || 0;
            $style.scoreGroupOffset = $id("scoreGroupOffset").value || 0;

            $style.nodeName = $id("nodeName").value;
            $style.groupName = $id("groupName").value;
            $style.totalGroupName = $id("totalGroupName").value;

            $style.required = parseInt($("input[name='required']:checked").val() || '0');


            for(var i=0; i<cells.length; i++) {
                var c = cells[i];
                var now = new Date();
                var cellInfo = ut.getCellInfo(c),rowIndex = cellInfo.rowIndex,colIndex = cellInfo.colIndex;
                
                if($style.border == "default"){

                }
                else if($style.border == "all") {
                    c.style.borderColor =  $style.borderColor
                    c.style.borderWidth = $style.borderWidth
                    c.style.borderStyle = "solid";

                    var previous = null;
                    if ((previous = c.previousElementSibling)) {
                        // if (previous.style.borderBottomColor) continue;

                        previous.style.borderRightColor = $style.borderColor;
                        previous.style.borderRightWidth = $style.borderWidth;
                    }

                    var top = null;
                    if (c.parentNode && c.parentNode.rowIndex > 0 && (top = c.parentNode.previousElementSibling.cells[c.cellIndex])) {
                        // if (top.style.borderBottomColor) continue;

                        top.style.borderBottomColor = $style.borderColor;
                        top.style.borderBottomWidth = $style.borderWidth;
                    }

                    console.log("set all border");
                } else if($style.border == "none"){
                    c.style.borderColor = null;
                    c.style.borderWidth = null;
                    c.style.borderStyle = null;
                    c.style.border = null;

                    c.removeAttribute("style");

                    // 强制去掉左侧和上面的边框
                    // var previous = null;
                    // if ((previous = c.previousElementSibling) && previous.style.borderBottomColor) {
                    //     previous.style.borderRightColor =  null;
                    //     previous.style.borderRightWidth =  null;
                    // }

                    // var top = null;
                    // if (c.parentNode && c.parentNode.rowIndex > 0 && (top = c.parentNode.previousElementSibling.cells[c.cellIndex]) && top.style.borderBottomColor) {
                    //     top.style.borderBottomColor = null;
                    //     top.style.borderBottomWidth =  null;
                    // }
                } else{
                    c.style.borderStyle = "solid";

                     if ($style.border.indexOf("left") > -1) {
                        c.style.borderLeftColor = $style.borderColor;
                        c.style.borderLeftWidth = $style.borderWidth;
                        // 左边上比较特殊 由于边框会被合并
                        // var previous = null;
                        // if ((previous = c.previousElementSibling)) {
                        //     if (previous.style.borderBottomColor) continue;

                        //     previous.style.borderRightColor = $style.borderColor;
                        //     previous.style.borderRightWidth = $style.borderWidth;
                        // }
                    }

                    if ($style.border.indexOf("top") > -1) {
                        c.style.borderTopColor = $style.borderColor;
                        c.style.borderTopWidth = $style.borderWidth;
                        // 获取上面单元格
                        // var previous = null;
                        // if (c.parentNode && c.parentNode.rowIndex > 0 && (previous = c.parentNode.previousElementSibling.cells[c.cellIndex])) {
                        //     if(previous.style.borderBottomColor) continue;

                        //     previous.style.borderBottomColor = $style.borderColor;
                        //     previous.style.borderBottomWidth = $style.borderWidth;
                        // }
                    }

                    if ($style.border.indexOf("right") > -1) {
                        c.style.borderRightColor  =  $style.borderColor;
                        c.style.borderRightWidth  =  $style.borderWidth;
                    }

                    if ($style.border.indexOf("bottom") > -1) {
                        c.style.borderBottomColor = $style.borderColor;
                        c.style.borderBottomWidth = $style.borderWidth;
                    }
                    
                }

                c.setAttribute("valign", $style.valign);
                c.setAttribute("align", $style.align);

                c.style.backgroundColor = $style.bgColor;

                // c.style.color = $style.color;
                // c.style.fontSize = $style.fontSize;

                if ($style.textType == "datetime") {
                    var dateFmt = $id("dateFmt").value || 'yyyy年MM月dd日';
                    $style.dateFmt = dateFmt;
                    var id= uuid();
                    var obj = {
                        type: 'datetime',
                        nodeName: $style.nodeName,
                        nodeId: id,
                        title: $style.nodeName,
                        defaultValue: '',
                        dateFmt: dateFmt,
                        minDate_1: format(new Date(now.getTime() - 365 * 60 * 60 * 1000), 'yyyy-MM-dd HH:mm:ss'),
                        maxDate_1: format(new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000), 'yyyy-MM-dd HH:mm:ss'),
                        defaultValue_1: format(new Date(), 'yyyy-MM-dd HH:mm:ss'),
                        vel: id,
                        required: $style.required
                    }
                    var objStr = JSON.stringify(obj).replace(/\"/g, '\'');
                    var placeStyle = "color:transparent;display:inline-block; width: 100%;overflow: hidden;height: 100%;line-height: 100%;text-align:center;";
                    var style = 'width:100%;color:#464646;height:100%;display:inline-block; width: 100%;word-wrap: break-word;'
                    //插入自动日期控件
                    var html = '<span class="hxiong-field hxplugin" style="' + placeStyle + '" hxplugin="datetime" id="' + obj.nodeId + '-0" title="' + obj.title + '" obj="' + objStr + '" contenteditable="false">';
                    html += '<span class="hxiong-field hxiong-field-value" style="' + style + '" value="' + (obj.defaultValue) + '" onclick="if(this.nodeType!=1)return;if(document.body.getAttribute(\'pattern\')==\'readonly\'){this.setAttribute(\'readonly\',\'readonly\');return;}else{this.removeAttribute(\'readonly\');}WdatePicker({dateFmt:\'' + obj.dateFmt + '\',vel:\'' + obj.nodeId + '\',minDate:\'' + obj.minDate_1 + '\',maxDate:\'' + obj.maxDate_1 + '\'})">&nbsp;</span>';
                    html += '<input type="hidden" id="' + obj.nodeId + '" value="' + obj.defaultValue_1 + '"/>';
                    html += '</span>';

                    // c.width = c.width > 120 ? c.width : 120;
                    c.innerHTML = html;
                } else if($style.textType == "text") {

                    var id = uuid();
                    var _nodeName = $id('nodeName').value;
                    if ($style.nodeNameSide == 'left') {
                        var _oofset1 = - parseInt($style.nodeNameOffset);
                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex][colIndex+_oofset1],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                    } else {
                        var _oofset1 = - parseInt($style.nodeNameOffset);
                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex+_oofset1][colIndex],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                    }
                    var obj = {
                        type: 'text',
                        nodeId: id,
                        nodeName: _nodeName,
                        title: _nodeName,
                        value: '',
                        groupName: $id("groupName").value || $style.groupName,
                        required: $style.required
                    }
                    var m_groupName = "item-" + $.md5(obj.groupName);

                    var objStr = JSON.stringify(obj).replace(/\"/g, '\'');

                    var editpanel = c.getElementsByClassName("hxiong-table-td-editable");
                    var oldHtml = '&nbsp;';
                    // console.log(editpanel);
                    if(editpanel && editpanel[0]) {
                        console.log('have editor panel');
                        oldHtml = editpanel[0].innerText;
                    }
                    console.log(oldHtml);
                    c.innerHTML = '<p class="hxplugin hxiong-table-td-editable" hxplugin="text" obj="'+ objStr+'" contenteditable="false" onkeydown="if(window.getSelection().focusOffset==0){if(event.keyCode==8||event.keyCode==46 ||event.keyCode==10){return false;}}" onblur="this.setAttribute(\'contenteditable\',false)" onclick="window._onTdPClickHandler(event,this)" >'+oldHtml+'</p>';

                }else if($style.textType == "score") {
                    var id = uuid();
                    var _nodeName = '';
                    var _score = '';
                    var _groupName = '';
                    if($style.scoreNameSide == 'left') {
                        var _oofset1 = - parseInt($style.scoreNameOffset);
                        var _oofset2 = - parseInt($style.scoreValueOffset);
                        var _oofset3 = - parseInt($style.scoreGroupOffset);

                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex][colIndex+_oofset1],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                        if (_oofset2 !== 0) {
                            var _lCi = ut.indexTable[rowIndex][colIndex+_oofset2],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];
                            _score = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                        if (_oofset3 !== 0) {
                            var _lCi = ut.indexTable[rowIndex][colIndex+_oofset3],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];
                            _groupName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                            $style.groupName = _groupName;
                        }
                    } else {
                        var _oofset1 = - parseInt($style.scoreNameOffset);
                        var _oofset2 = - parseInt($style.scoreValueOffset);
                        var _oofset3 = - parseInt($style.scoreGroupOffset);

                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex+_oofset1][colIndex],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                        if (_oofset2 !== 0) {
                            var _lCi = ut.indexTable[rowIndex+_oofset2][colIndex],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];
                            _score = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                        if (_oofset3 !== 0) {
                            var _lCi =ut.indexTable[rowIndex+_oofset3][colIndex],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];
                            _groupName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                            $style.groupName = _groupName;
                        }
                    }
                    var obj = {
                        type: 'score',
                        nodeId: id,
                        nodeName: _nodeName,
                        title: _nodeName,
                        value: '',
                        score: _score,
                        groupName: $id("groupName").value || $style.groupName,
                        totalGroupName: $id("totalGroupName").value || $style.totalGroupName,
                        group: groupId,
                        required: $style.required
                    }
                    var objStr = JSON.stringify(obj).replace(/\"/g, '\'');
                    c.innerHTML = '<p class="hxplugin hxiong-table-td-editable " onclick="window._onScoreClickHandler(event,this)" style="text-align:center;color:black;" hxplugin="score" obj="'+ objStr+'" contenteditable="false"><span class="hxiong-td-check-box" style="width:100%;display:inline-block;"><span style="color:blue;display:none;" group="' + groupId +'" class="hxiong-td-check"> √ <span></span></p>';
                } else if($style.textType == "check") {
                    var id = uuid();
                    var _nodeName = $id('nodeName').value;
                    if($style.nodeNameSide == 'left') {
                        var _oofset1 = - parseInt($style.nodeNameOffset);

                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex][colIndex+_oofset1],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                    } else {
                        var _oofset1 = - parseInt($style.nodeNameOffset);

                        if (_oofset1 !== 0) {
                            var _lCi = ut.indexTable[rowIndex+_oofset1][colIndex],
                            _lc = table.rows[_lCi.rowIndex].cells[_lCi.cellIndex];

                            _nodeName = _lc.innerText.replace(/[\n\r\s+]/g, '').replace(/&nbsp;/ig, "");
                        }
                    }
                    var obj = {
                        type: 'check',
                        nodeId: id,
                        nodeName: _nodeName,
                        title: _nodeName,
                        value: 0,
                        required: $style.required
                    }
                    var objStr = JSON.stringify(obj).replace(/\"/g, '\'');
                    c.innerHTML = '<p class="hxplugin hxiong-table-td-editable " onclick="window._onCheckClickHandler(event,this)" style="text-align:center;color:black;" hxplugin="check" obj="'+ objStr+'" contenteditable="false"><span class="hxiong-td-check-box" style="width:100%;display:inline-block;"><span style="color:blue;display:none;" class="hxiong-td-check"> √ <span></span></p>';
                } else if($style.textType == "empty") {
                    c.innerHTML = "";
                }
                c.setAttribute("hata", JSON.stringify($style).replace(/\"/g, '\''));
            }
        }
    }
</script>
</body>
</html>